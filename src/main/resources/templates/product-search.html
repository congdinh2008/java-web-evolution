<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <title th:text="${title}">Product Search</title>
    <th:block layout:fragment="css">
        <style>
            .search-form {
                background-color: white;
                padding: 20px;
                border-radius: 5px;
                margin-bottom: 20px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }
            .form-group {
                margin-bottom: 15px;
            }
            .form-group label {
                display: block;
                margin-bottom: 5px;
                font-weight: bold;
            }
            .form-group input, .form-group select {
                width: 100%;
                padding: 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
            }
            .filter-group {
                display: flex;
                gap: 10px;
                margin-bottom: 15px;
            }
            .filter-group .form-group {
                flex: 1;
            }
            .product-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }
            .product-card {
                background-color: white;
                border-radius: 5px;
                overflow: hidden;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                transition: transform 0.3s;
            }
            .product-card:hover {
                transform: translateY(-5px);
            }
            .product-card img {
                width: 100%;
                height: 200px;
                object-fit: cover;
            }
            .product-info {
                padding: 15px;
            }
            .product-name {
                font-weight: bold;
                margin-bottom: 5px;
                font-size: 1.1em;
            }
            .product-price {
                color: #e63946;
                font-weight: bold;
                margin-bottom: 5px;
            }
            .product-stock {
                font-size: 0.9em;
                color: #666;
            }
            .pagination {
                display: flex;
                justify-content: center;
                margin-top: 20px;
            }
            .pagination a, .pagination span {
                display: inline-block;
                padding: 8px 12px;
                margin: 0 5px;
                border-radius: 3px;
                text-decoration: none;
                color: #333;
            }
            .pagination a {
                background-color: #fff;
                border: 1px solid #ddd;
            }
            .pagination a:hover {
                background-color: #f5f5f5;
            }
            .pagination .active {
                background-color: #007bff;
                border: 1px solid #007bff;
                color: white;
            }
            .no-results {
                background-color: white;
                padding: 20px;
                border-radius: 5px;
                text-align: center;
                margin-bottom: 20px;
            }
            .sort-controls {
                display: flex;
                justify-content: flex-end;
                margin-bottom: 15px;
            }
            .sort-controls select {
                padding: 5px;
                border: 1px solid #ddd;
                border-radius: 4px;
                margin-left: 10px;
            }
            .search-button {
                padding: 8px 15px; 
                background-color: #007bff; 
                color: white; 
                border: none; 
                border-radius: 4px; 
                cursor: pointer;
            }
            .reset-button {
                padding: 8px 15px; 
                background-color: #6c757d; 
                color: white; 
                border: none; 
                border-radius: 4px; 
                cursor: pointer; 
                margin-left: 10px;
            }
        </style>
    </th:block>
</head>
<body>
    <div layout:fragment="content">
        <h1>Product Search</h1>
        
        <div class="search-form">
            <form th:action="@{/products/search}" method="get">
                <div class="form-group">
                    <label for="name">Product Name:</label>
                    <input type="text" id="name" name="name" th:value="${searchTerm}" placeholder="Search by product name...">
                </div>
                <div class="filter-group">
                    <div class="form-group">
                        <label for="minPrice">Min Price:</label>
                        <input type="number" id="minPrice" name="minPrice" th:value="${minPrice}" min="0" step="0.01" placeholder="Min price">
                    </div>
                    <div class="form-group">
                        <label for="maxPrice">Max Price:</label>
                        <input type="number" id="maxPrice" name="maxPrice" th:value="${maxPrice}" min="0" step="0.01" placeholder="Max price">
                    </div>
                </div>
                <div class="filter-group">
                    <div class="form-group">
                        <label for="sortBy">Sort By:</label>
                        <select id="sortBy" name="sortBy">
                            <option value="name" th:selected="${sortBy == 'name'}">Name</option>
                            <option value="unitPrice" th:selected="${sortBy == 'unitPrice'}">Price</option>
                            <option value="unitInStock" th:selected="${sortBy == 'unitInStock'}">Stock</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="direction">Direction:</label>
                        <select id="direction" name="direction">
                            <option value="ASC" th:selected="${direction == 'ASC'}">Ascending</option>
                            <option value="DESC" th:selected="${direction == 'DESC'}">Descending</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="search-button">Search</button>
                    <button type="button" onclick="location.href='/products'" class="reset-button">Reset</button>
                </div>
            </form>
        </div>
        
        <div class="no-results" th:if="${#lists.isEmpty(productPage.content)}">
            <h3>No products found matching your criteria</h3>
            <p>Try adjusting your search filters or browse all products.</p>
        </div>
        
        <div th:if="${!#lists.isEmpty(productPage.content)}">
            <div class="sort-controls">
                <span th:text="'Showing ' + ${productPage.numberOfElements} + ' of ' + ${productPage.totalElements} + ' products'">
                    Showing 10 of 50 products
                </span>
            </div>
            
            <div class="product-grid">
                <div class="product-card" th:each="product : ${productPage.content}">
                    <a th:href="@{/products/details(id=${product.id})}">
                        <img th:src="${product.thumbnailUrl}" th:alt="${product.name}">
                    </a>
                    <div class="product-info">
                        <div class="product-name" th:text="${product.name}">Product Name</div>
                        <div class="product-price" th:text="'$' + ${product.unitPrice}">$0.00</div>
                        <div class="product-stock">
                            <span th:if="${product.unitInStock > 10}" th:text="'In Stock (' + ${product.unitInStock} + ')'">
                                In Stock (20)
                            </span>
                            <span th:if="${product.unitInStock > 0 && product.unitInStock <= 10}" th:text="'Low Stock (' + ${product.unitInStock} + ')'">
                                Low Stock (5)
                            </span>
                            <span th:if="${product.unitInStock <= 0}">
                                Out of Stock
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Pagination -->
            <div class="pagination">
                <a th:if="${currentPage > 0}"
                   th:href="@{/products/search(name=${searchTerm},minPrice=${minPrice},maxPrice=${maxPrice},page=${currentPage - 1},size=${size},sortBy=${sortBy},direction=${direction})}">&laquo; Previous</a>
                
                <th:block th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                    <span class="active" th:if="${currentPage == i}" th:text="${i + 1}">1</span>
                    <a th:if="${currentPage != i}"
                       th:href="@{/products/search(name=${searchTerm},minPrice=${minPrice},maxPrice=${maxPrice},page=${i},size=${size},sortBy=${sortBy},direction=${direction})}"
                       th:text="${i + 1}">1</a>
                </th:block>
                
                <a th:if="${currentPage < totalPages - 1}"
                   th:href="@{/products/search(name=${searchTerm},minPrice=${minPrice},maxPrice=${maxPrice},page=${currentPage + 1},size=${size},sortBy=${sortBy},direction=${direction})}">Next &raquo;</a>
            </div>
        </div>
    </div>
</body>
</html>
